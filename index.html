<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Stock Manager</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    /* --- LIGHT THEME VARIABLES --- */
    :root {
      --bg-color: #f4f6f9;
      --card-bg: #ffffff;
      --text-main: #2d3436;
      --text-sub: #636e72;
      --accent-take: #6c5ce7;
      --accent-add: #00b894;
      --border: #dfe6e9;
      --shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    body {
      font-family: 'Poppins', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-main);
      margin: 0; padding: 0;
      height: 100vh; overflow: hidden;
    }

    /* --- LAYOUT UTILS --- */
    .hidden { display: none !important; }
    button { cursor: pointer; border: none; outline: none; -webkit-tap-highlight-color: transparent; }
    
    /* --- LANDING SCREEN --- */
    #view-landing {
      height: 100%; display: flex; flex-direction: column; 
      justify-content: center; align-items: center; padding: 25px; gap: 20px;
    }
    .landing-card {
      width: 100%; max-width: 340px; height: 160px;
      border-radius: 24px; color: white;
      display: flex; flex-direction: column; 
      justify-content: center; align-items: center;
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
      transition: transform 0.1s;
    }
    .landing-card:active { transform: scale(0.98); }
    .card-take { background: linear-gradient(135deg, #74b9ff, #0984e3); } /* Friendly Blue */
    .card-add { background: linear-gradient(135deg, #55efc4, #00b894); } /* Friendly Green */
    .btn-icon { font-size: 32px; margin-bottom: 5px; }
    .btn-label { font-size: 22px; font-weight: 600; }
    .btn-desc { font-size: 13px; opacity: 0.9; }

    /* --- APP SCREEN --- */
    #view-app { display: none; height: 100%; flex-direction: column; }
    
    .app-header {
      padding: 20px; background: var(--card-bg);
      box-shadow: 0 2px 10px rgba(0,0,0,0.03); z-index: 10;
      display: flex; align-items: center; justify-content: space-between;
    }
    .back-btn { background: #f1f2f6; color: var(--text-main); padding: 8px 15px; border-radius: 12px; font-weight: 600; font-size: 14px; }
    .page-title { font-weight: 600; font-size: 18px; }

    .app-content { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px; }

    /* INPUT STYLES */
    label { font-size: 12px; font-weight: 600; color: var(--text-sub); display: block; margin-bottom: 8px; margin-top: 15px; text-transform: uppercase; letter-spacing: 0.5px; }
    
    select, input {
      width: 100%; padding: 16px; 
      border: 1px solid var(--border);
      background: var(--card-bg);
      border-radius: 16px;
      font-size: 16px; color: var(--text-main);
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }
    select:focus, input:focus { border-color: var(--accent-take); }

    /* SEARCH RESULTS */
    #searchResults {
      background: white; border-radius: 16px; margin-top: 10px;
      box-shadow: var(--shadow); max-height: 250px; overflow-y: auto;
    }
    .search-item {
      padding: 15px; border-bottom: 1px solid #f1f2f6; display: flex; justify-content: space-between; align-items: center;
    }
    .add-btn { background: var(--text-main); color: white; padding: 8px 16px; border-radius: 10px; font-size: 12px; font-weight: 600; }

    /* CART CARDS (MATCHING YOUR IMAGE) */
    .cart-card {
      background: white; border-radius: 16px; padding: 15px; margin-bottom: 12px;
      display: flex; justify-content: space-between; align-items: center;
      box-shadow: var(--shadow); border: 1px solid #f1f2f6;
    }
    .item-info { display: flex; flex-direction: column; }
    .item-name { font-weight: 600; font-size: 16px; color: var(--text-main); }
    .item-cat { font-size: 12px; color: var(--text-sub); }

    /* QTY CONTROL (+ / -) */
    .qty-box {
      display: flex; align-items: center;
      background: #f1f2f6; border-radius: 12px; padding: 4px;
    }
    .qty-btn { width: 36px; height: 36px; font-size: 18px; font-weight: 600; background: transparent; color: var(--text-main); display: flex; justify-content: center; align-items: center; }
    .qty-val { width: 30px; text-align: center; font-weight: 600; font-size: 16px; }

    /* BOTTOM BAR */
    .bottom-bar {
      position: fixed; bottom: 0; left: 0; width: 100%; padding: 20px;
      background: white; border-top: 1px solid var(--border); box-sizing: border-box;
    }
    .submit-btn {
      width: 100%; padding: 18px; border-radius: 16px;
      font-size: 16px; font-weight: 600; color: white;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    /* LOADER */
    #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #ffffff; z-index: 999; display: flex; flex-direction: column; justify-content: center; align-items: center; color: var(--accent-take); font-weight: 600; }
  </style>
</head>
<body>

  <div id="loader">
    <div style="font-size:40px; margin-bottom:10px;">ðŸ“¦</div>
    <div>Loading System...</div>
  </div>

  <div id="view-landing" class="hidden">
    <button class="landing-card card-take" onclick="startApp('TAKE')">
      <span class="btn-icon">ðŸ“¤</span>
      <span class="btn-label">Take Item</span>
      <span class="btn-desc">Request Approval</span>
    </button>
    
    <button class="landing-card card-add" onclick="startApp('ADD')">
      <span class="btn-icon">ðŸ“¥</span>
      <span class="btn-label">Add Stock</span>
      <span class="btn-desc">Direct Update</span>
    </button>
  </div>

  <div id="view-app">
    <div class="app-header">
      <button class="back-btn" onclick="goHome()">Back</button>
      <span class="page-title" id="page-title">Request</span>
      <div style="width:50px"></div>
    </div>

    <div class="app-content">
      <label>Staff Member</label>
      <select id="userSelect"></select>

      <label>Purpose / Reason</label>
      <input type="text" id="purpose" placeholder="e.g. Meeting Room Setup...">

      <hr style="margin:25px 0; border:0; border-top:1px dashed #dfe6e9;">

      <label>Search Item</label>
      <input type="text" id="searchInput" placeholder="Type name..." autocomplete="off">
      <div id="searchResults" class="hidden"></div>

      <div id="cartList" style="margin-top:20px;"></div>
    </div>

    <div class="bottom-bar">
      <button id="mainBtn" class="submit-btn" onclick="submitData()">Confirm</button>
    </div>
  </div>

<script>
  // ===========================================
  // âš ï¸ PASTE YOUR NEW SCRIPT URL HERE ðŸ‘‡
  const API_URL = "https://script.google.com/macros/s/AKfycbxmNEt0719hv2EGnWsidajlOI0-xLYtgExDODtoyHcSE6NdabXL06PP2PE1abvUofv7/exec"; 

  const STAFF_LIST = [
    { name: "Ahmed", email: "ahmed.tanany@sirkil.com" },
    { name: "Abdullah", email: "abdallah.yahya@sirkil.com" },
    { name: "Omar", email: "omar@sirkil.com" },
    { name: "Amr", email: "amr@example.com" },
    { name: "Rami", email: "amr@example.com" },
    { name: "Hazem", email: "amr@example.com" }
  ];
  // ===========================================

  let inventory = [];
  let cart = [];
  let MODE = "";

  window.onload = async () => {
    // Populate Staff
    const sel = document.getElementById("userSelect");
    STAFF_LIST.forEach(u => sel.add(new Option(u.name, u.email)));

    // Load Data
    try {
      const res = await fetch(API_URL);
      inventory = await res.json();
      document.getElementById("loader").classList.add("hidden");
      document.getElementById("view-landing").classList.remove("hidden");
    } catch(e) {
      document.getElementById("loader").innerHTML = "Connection Failed.<br>Check Script URL.";
    }
  };

  function startApp(mode) {
    MODE = mode;
    document.getElementById("view-landing").classList.add("hidden");
    document.getElementById("view-app").style.display = "flex";
    
    const title = document.getElementById("page-title");
    const btn = document.getElementById("mainBtn");

    if (mode === 'TAKE') {
      title.innerText = "Take from Stock";
      btn.innerText = "Send Request";
      btn.style.background = "#0984e3";
    } else {
      title.innerText = "Add to Stock";
      btn.innerText = "Confirm Add";
      btn.style.background = "#00b894";
    }
  }

  function goHome() {
    document.getElementById("view-app").style.display = "none";
    document.getElementById("view-landing").classList.remove("hidden");
    cart = [];
    renderCart();
  }

  // SEARCH LOGIC
  const searchInput = document.getElementById("searchInput");
  const resultsDiv = document.getElementById("searchResults");

  searchInput.addEventListener("input", (e) => {
    const q = e.target.value.toLowerCase();
    resultsDiv.innerHTML = "";
    if (q.length < 2) { resultsDiv.classList.add("hidden"); return; }

    const matches = inventory.filter(i => i.name.toLowerCase().includes(q));
    if(matches.length > 0) {
      resultsDiv.classList.remove("hidden");
      matches.slice(0, 10).forEach(item => {
        const div = document.createElement("div");
        div.className = "search-item";
        div.innerHTML = `
          <div>
            <div style="font-weight:600;">${item.name}</div>
            <div style="font-size:12px; color:#aaa;">${item.category}</div>
          </div>
          <button class="add-btn" onclick="addToCart('${item.name}', '${item.category}')">ADD</button>
        `;
        resultsDiv.appendChild(div);
      });
    } else {
      resultsDiv.classList.add("hidden");
    }
  });

  function addToCart(name, category) {
    const existing = cart.find(c => c.name === name && c.category === category);
    if(existing) existing.qty++;
    else cart.push({ name, category, qty: 1 });
    
    renderCart();
    searchInput.value = "";
    resultsDiv.classList.add("hidden");
  }

  // CART UI (MATCHING IMAGE 2)
  function renderCart() {
    const list = document.getElementById("cartList");
    list.innerHTML = "";
    
    cart.forEach((item, idx) => {
      const div = document.createElement("div");
      div.className = "cart-card";
      div.innerHTML = `
        <div class="item-info">
          <span class="item-name">${item.name}</span>
          <span class="item-cat">${item.category}</span>
        </div>
        <div class="qty-box">
          <button class="qty-btn" onclick="modQty(${idx}, -1)">âˆ’</button>
          <span class="qty-val">${item.qty}</span>
          <button class="qty-btn" onclick="modQty(${idx}, 1)">+</button>
        </div>
      `;
      list.appendChild(div);
    });
  }

  function modQty(idx, delta) {
    cart[idx].qty += delta;
    if(cart[idx].qty <= 0) cart.splice(idx, 1);
    renderCart();
  }

  async function submitData() {
    if(cart.length === 0) return alert("Please add items.");
    const purpose = document.getElementById("purpose").value;
    if(!purpose) return alert("Enter a purpose.");

    const uSel = document.getElementById("userSelect");
    const user = { name: uSel.options[uSel.selectedIndex].text, email: uSel.value };

    const btn = document.getElementById("mainBtn");
    btn.innerText = "Processing...";
    btn.disabled = true;

    try {
      await fetch(API_URL, {
        method: "POST",
        mode: "no-cors",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ type: MODE, user, purpose, cart })
      });
      alert("Success! Action Recorded.");
      location.reload();
    } catch(e) {
      alert("Error sending data.");
      btn.disabled = false;
      btn.innerText = "Retry";
    }
  }
</script>
</body>
</html>